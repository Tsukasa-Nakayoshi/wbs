<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一次受けテストWBS</title>
    <!-- Chosen Palette: Warm Neutrals (Slate & Amber) -->
    <!-- Application Structure Plan: A dashboard-style SPA with three main views: 1) A Timeline (Gantt Chart) for chronological understanding, 2) A Task Board (Kanban) for status tracking, and 3) A Detailed List for granular filtering and searching. This structure provides multiple perspectives on the same data. Tab-based navigation makes switching between these analytical views seamless and intuitive. Data persistence is handled via browser's LocalStorage, meaning data is saved locally on the user's device and not synced across multiple users or devices. -->
    <!-- Visualization & Content Choices:
        - Overall Stats: Inform -> HTML Cards -> Non-interactive -> Quick, scannable summary -> HTML/Tailwind.
        - Status Breakdown: Compare -> Donut Chart -> Hover tooltips -> Visual comparison of task statuses -> Chart.js.
        - Project Timeline: Change -> Custom Gantt Chart -> Hover tooltips on bars -> Best visualization for schedules and dependencies -> Custom JS/HTML/CSS.
        - Task Status Board: Organize -> Kanban-style columns/cards -> Non-interactive -> Intuitive way to view workflow stages -> HTML/Tailwind.
        - Detailed Task List: Organize/Inform -> Filterable/Searchable Table -> Dropdown filters, text search, Edit/Delete buttons -> Provides deep-dive capability and granular data access -> Custom JS/HTML.
        - Add/Edit Task Form: Collect -> Modal Form -> User input for new/existing tasks -> HTML/Tailwind/JS.
        - Delete Confirmation: Confirm -> Modal -> Prevent accidental deletion -> HTML/Tailwind/JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let wbsData = []; // Will be populated from localStorage

        const dateDiffInDays = (a, b) => Math.ceil(Math.abs(a - b) / (1000 * 60 * 60 * 24));
        const statusColors = {
            "未着手": { bg: "bg-slate-200", text: "text-slate-800" },
            "進行中": { bg: "bg-sky-200", text: "text-sky-800" },
            "完了": { bg: "bg-emerald-200", text: "text-emerald-800" },
            "問題あり": { bg: "bg-red-200", text: "text-red-800" },
        };
        const statusChartColors = {
            "未着手": '#e2e8f0', // slate-200
            "進行中": '#7dd3fc', // sky-300
            "完了": '#6ee7b7', // emerald-300
            "問題あり": '#fca5a5' // red-300
        };

        // DOM elements and tabs
        const tabs = [
            { id: 'gantt', button: null, view: null },
            { id: 'board', button: null, view: null },
            { id: 'list', button: null, view: null }
        ];

        // For task editing
        let currentEditingTaskId = null;

        // --- Local Storage Functions ---
        function loadTasksFromLocalStorage() {
            try {
                const storedData = localStorage.getItem('wbsTasks');
                if (storedData) {
                    wbsData = JSON.parse(storedData);
                    // Ensure 'id' field for existing tasks for editing/deletion
                    wbsData = wbsData.map(task => ({ ...task, id: task.id || crypto.randomUUID() }));
                    // Sort data by start date for consistent display
                    wbsData.sort((a, b) => {
                        const dateA = new Date(a.start);
                        const dateB = new Date(b.start);
                        if (dateA.getTime() === dateB.getTime()) {
                            return new Date(a.end) - new Date(b.end);
                        }
                        return dateA - dateB;
                    });
                } else {
                    wbsData = [];
                }
            } catch (e) {
                console.error("Error loading tasks from local storage:", e);
                wbsData = []; // Reset on error
            }
            updateUI(); // Render UI after loading
        }

        function saveTasksToLocalStorage() {
            try {
                localStorage.setItem('wbsTasks', JSON.stringify(wbsData));
            } catch (e) {
                console.error("Error saving tasks to local storage:", e);
                // In a real app, provide user feedback here
            }
            updateUI(); // Render UI after saving
        }

        // --- UI Update Function (all renders consolidated) ---
        function updateUI() {
            renderMetrics();
            renderGanttChart();
            renderKanbanBoard();
            renderTaskList();
            setupFilters();
        }

        // --- Render Functions ---
        let statusChartInstance = null; // To store Chart.js instance for updates

        function renderMetrics() {
            if (wbsData.length === 0) {
                document.getElementById('total-duration').textContent = `0日`;
                document.getElementById('total-tasks').textContent = `0`;
                document.getElementById('current-progress').textContent = `0%`;
                if (statusChartInstance) {
                    statusChartInstance.destroy();
                    statusChartInstance = null;
                }
                document.getElementById('status-chart').getContext('2d').clearRect(0, 0, document.getElementById('status-chart').width, document.getElementById('status-chart').height);
                return;
            }

            const allDates = wbsData.flatMap(task => [new Date(task.start), new Date(task.end)]);
            const projectStartDate = new Date(Math.min(...allDates));
            const projectEndDate = new Date(Math.max(...allDates));
            const totalProjectDays = dateDiffInDays(projectStartDate, projectEndDate) + 1;

            document.getElementById('total-duration').textContent = `${totalProjectDays}日`;
            document.getElementById('total-tasks').textContent = wbsData.length;

            const completedTasks = wbsData.filter(t => t.status === '完了').length;
            const progress = wbsData.length > 0 ? Math.round((completedTasks / wbsData.length) * 100) : 0;
            document.getElementById('current-progress').textContent = `${progress}%`;

            const statusCounts = wbsData.reduce((acc, task) => {
                acc[task.status] = (acc[task.status] || 0) + 1;
                return acc;
            }, {});

            const ctx = document.getElementById('status-chart').getContext('2d');
            if (statusChartInstance) {
                statusChartInstance.data.labels = Object.keys(statusCounts);
                statusChartInstance.data.datasets[0].data = Object.values(statusCounts);
                statusChartInstance.data.datasets[0].backgroundColor = Object.keys(statusCounts).map(status => statusChartColors[status]);
                statusChartInstance.update();
            } else {
                statusChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(statusCounts),
                        datasets: [{
                            data: Object.values(statusCounts),
                            backgroundColor: Object.keys(statusCounts).map(status => statusChartColors[status]),
                            borderWidth: 2,
                            borderColor: '#f8fafc'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                bodyFont: { family: 'Noto Sans JP' },
                                titleFont: { family: 'Noto Sans JP' },
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed + ' (' + ((context.parsed / wbsData.length) * 100).toFixed(1) + '%)';
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        cutout: '70%'
                    }
                });
            }
        }

        function renderGanttChart() {
            const container = document.getElementById('gantt-chart-container');
            container.innerHTML = '';

            if (wbsData.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-slate-500 col-span-full">タスクがありません。新しいタスクを追加してください。</div>';
                return;
            }

            const allDates = wbsData.flatMap(task => [new Date(task.start), new Date(task.end)]);
            const projectStartDate = new Date(Math.min(...allDates));
            const projectEndDate = new Date(Math.max(...allDates));
            const totalProjectDays = dateDiffInDays(projectStartDate, projectEndDate) + 1;

            const taskColDiv = document.createElement('div');
            taskColDiv.className = 'gantt-task-col';
            const timelineColDiv = document.createElement('div');
            timelineColDiv.className = 'gantt-timeline-col overflow-x-auto';

            const taskHeader = document.createElement('div');
            taskHeader.className = 'font-bold p-2 border-b bg-slate-50 sticky top-0 z-10';
            taskHeader.textContent = 'タスク';
            taskColDiv.appendChild(taskHeader);

            const monthHeadersDiv = document.createElement('div');
            monthHeadersDiv.id = 'gantt-month-headers';
            monthHeadersDiv.className = 'grid border-b border-gray-300 bg-gray-200 sticky top-0 z-10';
            monthHeadersDiv.style.gridTemplateColumns = `repeat(${totalProjectDays}, minmax(30px, 1fr))`;

            const dayHeadersDiv = document.createElement('div');
            dayHeadersDiv.id = 'gantt-day-headers';
            dayHeadersDiv.className = 'grid border-b border-gray-300 bg-gray-50 sticky top-0 z-10';
            dayHeadersDiv.style.gridTemplateColumns = `repeat(${totalProjectDays}, minmax(30px, 1fr))`;

            const ganttBarsArea = document.createElement('div');
            ganttBarsArea.id = 'gantt-bars-area';

            timelineColDiv.appendChild(monthHeadersDiv);
            timelineColDiv.appendChild(dayHeadersDiv);
            timelineColDiv.appendChild(ganttBarsArea);

            let currentMonth = -1;
            let monthDayCount = 0;
            const monthSpans = [];

            for (let i = 0; i < totalProjectDays; i++) {
                const d = new Date(projectStartDate);
                d.setDate(d.getDate() + i);

                if (d.getMonth() !== currentMonth) {
                    if (currentMonth !== -1) {
                        monthSpans.push({
                            // YYYY年を削除し、M月のみに
                            text: new Date(d.getFullYear(), currentMonth, 1).toLocaleString('ja-JP', { month: 'long' }),
                            span: monthDayCount
                        });
                    }
                    currentMonth = d.getMonth();
                    monthDayCount = 0;
                }
                monthDayCount++;

                const dayHeader = document.createElement('div');
                dayHeader.className = `p-1 text-center text-xs border-r border-gray-200 ${d.getDay() === 0 || d.getDay() === 6 ? 'bg-red-50 text-red-600' : 'bg-gray-50 text-gray-500'}`;
                dayHeader.textContent = d.getDate();
                if (d.getDate() === 1) {
                    dayHeader.textContent = `${d.getMonth()+1}/${d.getDate()}`;
                    dayHeader.classList.add('font-bold', 'text-slate-700');
                }
                dayHeadersDiv.appendChild(dayHeader);
            }
            if (currentMonth !== -1 && monthDayCount > 0) {
                 monthSpans.push({
                    // YYYY年を削除し、M月のみに
                    text: new Date(projectEndDate.getFullYear(), currentMonth, 1).toLocaleString('ja-JP', { month: 'long' }),
                    span: monthDayCount
                });
            }

            monthSpans.forEach(spanInfo => {
                const monthDiv = document.createElement('div');
                // whitespace-nowrap を追加し、改行を防ぐ
                monthDiv.className = `col-span-${spanInfo.span} p-2 text-center font-semibold text-gray-800 bg-gray-200 border-r border-gray-300 whitespace-nowrap`;
                monthDiv.textContent = spanInfo.text;
                monthHeadersDiv.appendChild(monthDiv);
            });

            wbsData.forEach(task => {
                const taskLabel = document.createElement('div');
                taskLabel.className = 'text-sm p-2 border-b whitespace-nowrap overflow-hidden text-ellipsis';
                taskLabel.textContent = task.name;
                taskColDiv.appendChild(taskLabel);

                const taskRow = document.createElement('div');
                taskRow.className = 'relative grid border-b';
                taskRow.style.gridTemplateColumns = `repeat(${totalProjectDays}, 1fr)`;

                const startOffset = dateDiffInDays(projectStartDate, new Date(task.start));
                const duration = dateDiffInDays(new Date(task.start), new Date(task.end)) + 1;

                const bar = document.createElement('div');
                bar.className = 'gantt-bar h-6 my-1 rounded flex items-center justify-start px-2 text-white text-xs relative';
                bar.style.gridColumn = `${startOffset + 1} / span ${duration}`;
                bar.style.backgroundColor = statusChartColors[task.status] || '#a0aec0';

                const tooltip = document.createElement('div');
                tooltip.className = 'absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max p-2 bg-slate-800 text-white text-xs rounded shadow-lg opacity-0 pointer-events-none transition-opacity duration-200 z-10';
                tooltip.innerHTML = `<strong>${task.name}</strong><br>期間: ${task.start} ~ ${task.end}<br>担当: ${task.person}<br>状態: ${task.status}`;
                bar.appendChild(tooltip);

                bar.addEventListener('mouseover', () => tooltip.style.opacity = 1);
                bar.addEventListener('mouseout', () => tooltip.style.opacity = 0);

                taskRow.appendChild(bar);
                ganttBarsArea.appendChild(taskRow);
            });

            container.appendChild(taskColDiv);
            container.appendChild(timelineColDiv);
        }

        function renderKanbanBoard() {
            const container = document.getElementById('kanban-board-container');
            container.innerHTML = '';

            if (wbsData.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-slate-500 col-span-full">タスクがありません。新しいタスクを追加してください。</div>';
                return;
            }

            const statuses = ["未着手", "進行中", "完了", "問題あり"];
            statuses.forEach(status => {
                const column = document.createElement('div');
                column.className = 'bg-slate-100 rounded-lg p-3';
                const tasksInStatus = wbsData.filter(t => t.status === status);

                column.innerHTML = `
                    <h3 class="font-bold mb-3 text-slate-700">${status} <span class="text-sm font-normal text-slate-500">${tasksInStatus.length}</span></h3>
                    <div class="space-y-3">
                        ${tasksInStatus.map(task => `
                            <div class="bg-white p-3 rounded-md shadow-sm border-l-4 ${statusColors[task.status].bg.replace('bg-', 'border-')}">
                                <p class="font-medium text-sm">${task.name}</p>
                                <p class="text-xs text-slate-500 mt-1">${task.person}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(column);
            });
        }

        function renderTaskList(filteredData = wbsData) {
            const tbody = document.getElementById('task-list-body');
            tbody.innerHTML = '';
            if (filteredData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="text-center py-8 text-slate-500">該当するタスクはありません。</td></tr>`;
                return;
            }
            filteredData.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-slate-900">${task.name}</div>
                        <div class="text-sm text-slate-500">${task.phase}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${task.person}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${task.start} ~ ${task.end} (${task.duration}日)</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColors[task.status].bg} ${statusColors[task.status].text}">
                            ${task.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button data-task-id="${task.id}" class="edit-task-btn text-amber-600 hover:text-amber-900 mr-3">編集</button>
                        <button data-task-id="${task.id}" class="delete-task-btn text-red-600 hover:text-red-900">削除</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.querySelectorAll('.edit-task-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const taskId = event.target.dataset.taskId;
                    const taskToEdit = wbsData.find(t => t.id === taskId);
                    if (taskToEdit) {
                        openEditModal(taskToEdit);
                    }
                });
            });

            document.querySelectorAll('.delete-task-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const taskId = event.target.dataset.taskId;
                    showDeleteConfirmModal(taskId);
                });
            });
        }

        function setupFilters() {
            const persons = [...new Set(wbsData.map(t => t.person))];
            const phases = [...new Set(wbsData.map(t => t.phase))];

            const personFilter = document.getElementById('filter-person');
            personFilter.innerHTML = '<option value="">全担当者</option>';
            persons.forEach(p => personFilter.innerHTML += `<option value="${p}">${p}</option>`);

            const phaseFilter = document.getElementById('filter-phase');
            phaseFilter.innerHTML = '<option value="">全フェーズ</option>';
            phases.forEach(p => phaseFilter.innerHTML += `<option value="${p}">${p}</option>`);

            const searchInput = document.getElementById('search-input');

            const applyFilters = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedPerson = personFilter.value;
                const selectedPhase = phaseFilter.value;

                const filtered = wbsData.filter(task =>
                    task.name.toLowerCase().includes(searchTerm) &&
                    (selectedPerson === '' || task.person === selectedPerson) &&
                    (selectedPhase === '' || task.phase === selectedPhase)
                );
                renderTaskList(filtered);
            };

            [searchInput, personFilter, phaseFilter].forEach(el => el.addEventListener('input', applyFilters));
        }

        // --- Add/Edit Task Modal Logic ---
        function showAddTaskModal() {
            currentEditingTaskId = null;
            document.getElementById('add-task-modal-title').textContent = '新しいタスクを追加';
            document.getElementById('add-edit-task-button').textContent = 'タスクを追加';
            document.getElementById('add-task-form').reset();
            document.getElementById('add-task-modal').classList.remove('hidden');
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('modal-message').classList.add('hidden');
        }

        function openEditModal(task) {
            currentEditingTaskId = task.id;
            document.getElementById('add-task-modal-title').textContent = 'タスクを編集';
            document.getElementById('add-edit-task-button').textContent = '変更を保存';

            document.getElementById('new-task-name').value = task.name;
            document.getElementById('new-task-person').value = task.person;
            document.getElementById('new-task-start').value = task.start;
            document.getElementById('new-task-end').value = task.end;
            document.getElementById('new-task-phase').value = task.phase;
            document.getElementById('new-task-status').value = task.status;

            document.getElementById('add-task-modal').classList.remove('hidden');
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('modal-message').classList.add('hidden');
        }

        function hideAddTaskModal() {
            document.getElementById('add-task-modal').classList.add('hidden');
            document.getElementById('modal-overlay').classList.add('hidden');
            document.getElementById('add-task-form').reset();
            document.getElementById('modal-message').classList.add('hidden');
            currentEditingTaskId = null;
        }

        function handleSubmitTask(event) {
            event.preventDefault();

            document.getElementById('modal-message').textContent = '';
            document.getElementById('modal-message').classList.add('hidden');
            document.getElementById('modal-message').classList.remove('text-red-600', 'text-green-600');

            const name = document.getElementById('new-task-name').value;
            const person = document.getElementById('new-task-person').value;
            const start = document.getElementById('new-task-start').value;
            const end = document.getElementById('new-task-end').value;
            const phase = document.getElementById('new-task-phase').value;
            const status = document.getElementById('new-task-status').value;

            if (!name || !person || !start || !end || !phase || !status) {
                document.getElementById('modal-message').textContent = 'すべての項目を入力してください。';
                document.getElementById('modal-message').classList.remove('hidden');
                document.getElementById('modal-message').classList.add('text-red-600');
                return;
            }

            const startDate = new Date(start);
            const endDate = new Date(end);
            if (startDate > endDate) {
                document.getElementById('modal-message').textContent = '終了日は開始日以降に設定してください。';
                document.getElementById('modal-message').classList.remove('hidden');
                document.getElementById('modal-message').classList.add('text-red-600');
                return;
            }

            const duration = dateDiffInDays(startDate, endDate) + 1;

            const taskData = {
                id: currentEditingTaskId || crypto.randomUUID(), // Generate new ID if adding
                name: name,
                person: person,
                start: start,
                end: end,
                phase: phase,
                status: status,
                duration: duration
            };

            if (currentEditingTaskId) {
                // Update existing task
                const taskIndex = wbsData.findIndex(t => t.id === currentEditingTaskId);
                if (taskIndex !== -1) {
                    wbsData[taskIndex] = taskData;
                    document.getElementById('modal-message').textContent = 'タスクが正常に更新されました！';
                } else {
                    document.getElementById('modal-message').textContent = 'エラー: タスクが見つかりませんでした。';
                    document.getElementById('modal-message').classList.remove('hidden');
                    document.getElementById('modal-message').classList.add('text-red-600');
                    return;
                }
            } else {
                // Add new task
                wbsData.push(taskData);
                document.getElementById('modal-message').textContent = 'タスクが正常に追加されました！';
            }

            document.getElementById('modal-message').classList.remove('hidden');
            document.getElementById('modal-message').classList.add('text-green-600');

            saveTasksToLocalStorage(); // Save to local storage after modification

            setTimeout(() => {
                hideAddTaskModal();
            }, 1500);
        }

        // --- Delete Confirmation Modal Logic ---
        let taskIdToDelete = null;

        function showDeleteConfirmModal(taskId) {
            taskIdToDelete = taskId;
            document.getElementById('delete-confirm-modal').classList.remove('hidden');
            document.getElementById('modal-overlay').classList.remove('hidden');
        }

        function hideDeleteConfirmModal() {
            taskIdToDelete = null;
            document.getElementById('delete-confirm-modal').classList.add('hidden');
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        function handleDeleteConfirmed() {
            if (!taskIdToDelete) return;

            wbsData = wbsData.filter(task => task.id !== taskIdToDelete);
            saveTasksToLocalStorage(); // Save to local storage after deletion

            hideDeleteConfirmModal();
        }

        // --- Main Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            tabs[0].button = document.getElementById('tab-gantt');
            tabs[0].view = document.getElementById('view-gantt');
            tabs[1].button = document.getElementById('tab-board');
            tabs[1].view = document.getElementById('view-board');
            tabs[2].button = document.getElementById('tab-list');
            tabs[2].view = document.getElementById('view-list');

            tabs.forEach(tab => {
                tab.button.addEventListener('click', () => {
                    tabs.forEach(t => {
                        t.button.classList.remove('tab-active');
                        t.view.classList.add('hidden');
                    });
                    tab.button.classList.add('tab-active');
                    tab.view.classList.remove('hidden');
                });
            });

            document.getElementById('add-task-btn').addEventListener('click', showAddTaskModal);
            document.getElementById('close-modal-btn').addEventListener('click', hideAddTaskModal);
            document.getElementById('modal-overlay').addEventListener('click', hideAddTaskModal);
            document.getElementById('add-task-form').addEventListener('submit', handleSubmitTask);

            document.getElementById('delete-confirm-yes').addEventListener('click', handleDeleteConfirmed);
            document.getElementById('delete-confirm-no').addEventListener('click', hideDeleteConfirmModal);

            // Load tasks from local storage and initialize UI
            loadTasksFromLocalStorage();
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .tab-active {
            border-color: #f59e0b; /* amber-500 */
            color: #f59e0b; /* amber-500 */
            background-color: #fffbeb; /* amber-50 */
        }
        .chart-container {
            position: relative;
            width: 100%; /* Take full width of parent column */
            max-width: 400px; /* Limit max width on larger screens */
            margin-left: auto;
            margin-right: auto; /* Center it */
            height: 250px; /* Base height */
            max-height: 350px; /* Max height */
        }
        /* Adjust for smaller screens if needed */
        @media (max-width: 768px) {
            .chart-container {
                height: 200px;
                max-height: 250px;
            }
        }

        .gantt-grid {
            display: grid;
            grid-template-columns: minmax(150px, 250px) 1fr; /* Responsive task column width */
        }
        .gantt-timeline-col {
            overflow-x: auto; /* This column specifically scrolls horizontally */
            width: 100%; /* Ensure it takes full available width in its grid cell */
        }
        .gantt-timeline-col > .grid { /* Apply to month/day headers */
            min-width: fit-content; /* Ensure grid does not shrink below content */
        }
        .gantt-bar {
            /* color will be set by JS based on status */
            transition: background-color 0.2s;
        }
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
    </style>
</head>
<body class="text-slate-700">

    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-slate-800">一次受けテストWBS</h1>
            <p class="mt-2 text-lg text-slate-600">プロジェクト全体の状況とタスク詳細をインタラクティブに可視化します。（データはブラウザにローカル保存されます）</p>
            <div id="user-info" class="mt-4 text-sm text-slate-500">
                <span>データはローカルに保存されます。</span>
            </div>
        </header>

        <!-- Key Metrics -->
        <section id="metrics-section" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm flex items-center space-x-4">
                <div class="bg-amber-100 p-3 rounded-full">
                    <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                </div>
                <div>
                    <p class="text-sm text-slate-500">総期間</p>
                    <p id="total-duration" class="text-2xl font-bold text-slate-800">0日</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm flex items-center space-x-4">
                <div class="bg-sky-100 p-3 rounded-full">
                    <svg class="w-6 h-6 text-sky-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                </div>
                <div>
                    <p class="text-sm text-slate-500">総タスク数</p>
                    <p id="total-tasks" class="text-2xl font-bold text-slate-800">0</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm flex items-center space-x-4">
                 <div class="bg-emerald-100 p-3 rounded-full">
                    <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <div>
                    <p class="text-sm text-slate-500">現在の進捗</p>
                    <p id="current-progress" class="text-2xl font-bold text-slate-800">0%</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm">
                <p class="text-sm text-slate-500 text-center mb-2">ステータス別タスク</p>
                <div class="chart-container">
                    <canvas id="status-chart"></canvas>
                </div>
            </div>
        </section>

        <!-- Navigation & Views -->
        <main class="bg-white p-4 sm:p-6 rounded-xl shadow-sm">
            <!-- Tabs -->
            <div class="border-b border-slate-200 mb-6">
                <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                    <button id="tab-gantt" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-active">タイムライン (ガントチャート)</button>
                    <button id="tab-board" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-slate-500 hover:text-amber-600 hover:border-amber-300">タスクボード (カンバン)</button>
                    <button id="tab-list" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-slate-500 hover:text-amber-600 hover:border-amber-300">タスク一覧 (詳細)</button>
                </nav>
            </div>

            <!-- Views Container -->
            <div>
                <!-- Gantt Chart View -->
                <div id="view-gantt">
                    <p class="text-slate-600 mb-4">プロジェクトの全タスクを時系列で表示します。各バーにカーソルを合わせると詳細が表示されます。</p>
                    <div id="gantt-chart-container" class="gantt-grid">
                        <!-- JSで生成 -->
                    </div>
                </div>

                <!-- Kanban Board View -->
                <div id="view-board" class="hidden">
                     <p class="text-slate-600 mb-4">タスクを「未着手」「進行中」「完了」のステータス別に表示します。</p>
                     <div id="kanban-board-container" class="kanban-board">
                        <!-- JSで生成 -->
                    </div>
                </div>

                <!-- Task List View -->
                <div id="view-list" class="hidden">
                    <p class="text-slate-600 mb-4">全タスクを一覧で表示します。担当者やフェーズでの絞り込み、タスク名での検索が可能です。</p>
                    <div class="flex flex-wrap gap-4 mb-4">
                        <input id="search-input" type="text" placeholder="タスク名で検索..." class="w-full md:w-auto flex-grow p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                        <select id="filter-person" class="p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                            <option value="">全担当者</option>
                        </select>
                        <select id="filter-phase" class="p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                            <option value="">全フェーズ</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">タスク名</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">担当者</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">期間</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">状態</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="task-list-body" class="bg-white divide-y divide-slate-200">
                                <!-- JSで生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Add Task Button -->
            <div class="mt-6 text-center">
                <button id="add-task-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 flex items-center justify-center mx-auto">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    新しいタスクを追加
                </button>
            </div>

        </main>

        <!-- Add/Edit Task Modal -->
        <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-40"></div>
        <div id="add-task-modal" class="fixed inset-0 hidden flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="add-task-modal-title" class="text-xl font-bold text-slate-800">新しいタスクを追加</h2>
                    <button id="close-modal-btn" class="text-slate-500 hover:text-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <form id="add-task-form" class="space-y-4">
                    <div id="modal-message" class="hidden p-3 rounded-md text-sm font-medium"></div>
                    <div>
                        <label for="new-task-name" class="block text-sm font-medium text-slate-700">タスク名</label>
                        <input type="text" id="new-task-name" required class="mt-1 block w-full p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                    </div>
                    <div>
                        <label for="new-task-person" class="block text-sm font-medium text-slate-700">担当者</label>
                        <input type="text" id="new-task-person" required class="mt-1 block w-full p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="new-task-start" class="block text-sm font-medium text-slate-700">開始日</label>
                            <input type="date" id="new-task-start" required class="mt-1 block w-full p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                        </div>
                        <div>
                            <label for="new-task-end" class="block text-sm font-medium text-slate-700">終了日</label>
                            <input type="date" id="new-task-end" required class="mt-1 block w-full p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                        </div>
                    </div>
                    <div>
                        <label for="new-task-phase" class="block text-sm font-medium text-slate-700">フェーズ</label>
                        <input type="text" id="new-task-phase" required class="mt-1 block w-full p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                    </div>
                    <div>
                        <label for="new-task-status" class="block text-sm font-medium text-slate-700">状態</label>
                        <select id="new-task-status" required class="mt-1 block w-full p-2 border border-slate-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
                            <option value="未着手">未着手</option>
                            <option value="進行中">進行中</option>
                            <option value="完了">完了</option>
                            <option value="問題あり">問題あり</option>
                        </select>
                    </div>
                    <button type="submit" id="add-edit-task-button" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200">
                        タスクを追加
                    </button>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-40"></div>
        <div id="delete-confirm-modal" class="fixed inset-0 hidden flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
                <h2 class="text-xl font-bold text-slate-800 mb-4">タスクを削除しますか？</h2>
                <p class="text-slate-600 mb-6">この操作は元に戻せません。</p>
                <div class="flex justify-center space-x-4">
                    <button id="delete-confirm-yes" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">はい</button>
                    <button id="delete-confirm-no" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors duration-200">いいえ</button>
                </div>
            </div>
        </div>

    </div>

</body>
</html>
